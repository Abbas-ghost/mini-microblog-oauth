<!doctype html>
<html>
  <head><meta charset="utf-8"><title>Mini Microblog</title></head>
  <body>
    <h1>Mini Microblog</h1>

    {% if profile %}
  <p>Signed in as {{ profile.login }}.
     <img src="{{ profile.avatar_url }}" alt="avatar" width="24" height="24" style="vertical-align:middle;border-radius:50%">
     <a href="{{ url_for('logout') }}">Logout</a>
  </p>
{% endif %}

    {% if not profile %}
  <p><a href="/login">Login with GitHub</a></p>
{% endif %}

    {% if profile %}
  <form action="/create" method="post">
    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
    <textarea name="content" rows="4" cols="60" placeholder="Write something..."></textarea><br>
    <button type="submit">Post</button>
  </form>
{% else %}
  <p>Please <a href="/login">log in</a> to post.</p>
{% endif %}


    <h2>Recent posts</h2>
    <ul>
      {% for p in posts %}
        <li>
          <div><strong>#{{ p.id }}</strong> — {{ p.created_at }}{% if p.author_name %} — by {{ p.author_name }}{% endif %}</div>
          <!-- SAFE RENDER for now -->
          <div>{{ p.content | safe }}</div>
        </li>
      {% else %}
        <li>No posts yet.</li>
      {% endfor %}
    </ul>
  </body>
</html>
